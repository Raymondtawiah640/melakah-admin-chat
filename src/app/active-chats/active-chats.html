<div class="flex h-full">
  <!-- Sidebar -->
  <div class="w-1/4 border-r p-2 overflow-y-auto">
    <div *ngFor="let user of users" (click)="selectUser(user.id)"
         class="p-2 cursor-pointer hover:bg-purple-100 rounded mb-1"
         [ngClass]="{'bg-purple-200': currentUserId === user.id}">
      {{ user.name }}
    </div>
  </div>

  <!-- Chat Box -->
  <div class="flex-1 flex flex-col bg-white shadow rounded-lg">
    <!-- Chat Header -->
    <div class="px-4 py-2 border-b bg-purple-100 font-semibold">
      {{ currentUserName }}
    </div>

    <!-- Messages -->
    <div class="flex-1 overflow-y-auto p-4 space-y-3" #scrollContainer>
      <div *ngIf="loading" class="text-center text-gray-500">Loading...</div>

      <div *ngFor="let msg of messages" class="flex flex-col">
        <div [ngClass]="{
              'flex justify-start': msg.sender_id === senderId, 
              'flex justify-end': msg.sender_id !== senderId   
            }">
          <span class="inline-block px-3 py-2 rounded-lg max-w-xs break-words"
                [ngClass]="{
                  'bg-green-500 text-white': msg.sender_id === senderId,
                  'bg-gray-200 text-black': msg.sender_id !== senderId
                }">
            {{ msg.message }}
          </span>
        </div>

        <!-- Timestamp -->
        <div [ngClass]="{
              'text-left text-xs text-gray-400 mt-1 ml-1': msg.sender_id === senderId,
              'text-right text-xs text-gray-400 mt-1 mr-1': msg.sender_id !== senderId
            }">
          {{ msg.created_at | date:'shortTime' }}
        </div>
      </div>
    </div>

    <!-- Input -->
    <div class="border-t flex items-center p-2">
      <input [(ngModel)]="newMessage"
             placeholder="Type your message..."
             class="flex-1 px-3 py-2 border rounded-l focus:outline-none"
             (keyup.enter)="sendMessage()">
      <button (click)="sendMessage()"
              class="bg-purple-500 text-white px-4 py-2 rounded-r">
        Send
      </button>
    </div>
  </div>
</div>
