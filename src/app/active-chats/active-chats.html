<div class="flex h-full min-h-screen bg-gray-50">

  <!-- Sidebar: Users -->
  <div class="w-1/4 border-r bg-white p-2 overflow-y-auto">
    <h2 class="text-xl font-semibold text-purple-700 mb-3">Active Chats</h2>
    <div *ngFor="let user of users" (click)="selectUser(user.id)"
         class="p-3 cursor-pointer hover:bg-purple-100 rounded-lg mb-2 transition-colors duration-200"
         [ngClass]="{'bg-purple-200': currentUserId === user.id, 'hover:bg-purple-100': currentUserId !== user.id}">
      {{ user.name }}
    </div>
  </div>

  <!-- Chat Box -->
  <div class="flex-1 flex flex-col bg-white shadow-lg rounded-lg mx-2">

    <!-- Chat Header -->
    <div class="px-4 py-3 border-b bg-purple-100 font-semibold text-purple-800 text-lg rounded-t-lg">
      {{ currentUserName || 'Select a user to start chat' }}
    </div>

    <!-- Messages -->
    <div class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50" #scrollContainer>
      <div *ngIf="loading" class="text-center text-gray-500 py-4">
        Loading chats...
      </div>

      <div *ngFor="let msg of messages" class="flex flex-col">
        <div [ngClass]="{
              'flex justify-start': msg.sender_id === senderId, 
              'flex justify-end': msg.sender_id !== senderId   
            }">
          <span class="inline-block px-4 py-2 rounded-lg max-w-xs break-words shadow-sm"
                [ngClass]="{
                  'bg-green-500 text-white': msg.sender_id === senderId,
                  'bg-gray-200 text-gray-800': msg.sender_id !== senderId
                }">
            {{ msg.message }}
          </span>
        </div>

        <!-- Timestamp -->
        <div [ngClass]="{
              'text-left text-xs text-gray-400 mt-1 ml-2': msg.sender_id === senderId,
              'text-right text-xs text-gray-400 mt-1 mr-2': msg.sender_id !== senderId
            }">
          {{ msg.created_at | date:'shortTime' }}
        </div>
      </div>
    </div>

    <!-- Input -->
    <div class="border-t flex items-center p-3 bg-white rounded-b-lg">
      <input [(ngModel)]="newMessage"
             placeholder="Type your message..."
             class="flex-1 px-4 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-purple-300"
             (keyup.enter)="sendMessage()">
      <button (click)="sendMessage()"
              class="bg-purple-500 hover:bg-purple-600 text-white px-5 py-2 rounded-r-lg transition-colors duration-200">
        Send
      </button>
    </div>

  </div>
</div>
